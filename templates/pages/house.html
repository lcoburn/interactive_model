{% extends "base.html" %} {% block content %} {% load static %}

<script type="module" src="/static/js/model_dynamic.js"></script>
<link rel="stylesheet" href="/static/css/model_dynamic.css" />

<script>
    // Access specific properties within the data object
    var houseInfoStr = "{{ house_data.houseInfo|safe }}";
    var houseInfo = JSON.parse(houseInfoStr.replace(/'/g, '"'));
    var housesGeometryStr = "{{ house_data.housesGeometry|safe }}";
    var housesGeometry = JSON.parse(housesGeometryStr.replace(/'/g, '"'));
    var sitesGeometryStr = "{{ house_data.sitesGeometry|safe }}";
    var sitesGeometry = JSON.parse(sitesGeometryStr.replace(/'/g, '"'));
    var adjustableCasesStr = "{{ house_data.adjustableCases|safe }}";
    var adjustableCases = JSON.parse(
        adjustableCasesStr
            .replace(/'/g, '"')
            .replace(/None/g, "null")
            .replace(/True/g, "true")
            .replace(/False/g, "false")
    );
    var houseDataStr = "{{ house_data|safe }}";
    var houseData = JSON.parse(
        houseDataStr
            .replace(/'/g, '"')
            .replace(/None/g, "null")
            .replace(/True/g, "true")
            .replace(/False/g, "false")
    );
    var main_block = housesGeometry.Main[0];
    let centreX = 0;
    let centreY = 0;
    let centreZ = 0;
    for (let i = 0; i < main_block.vertices.length; i++) {
        centreX += main_block.vertices[i].x;
        centreY += main_block.vertices[i].y;
        centreZ += main_block.vertices[i].z;
    }
    centreX = centreX / main_block.vertices.length;
    centreY = centreY / main_block.vertices.length;
    centreZ = centreZ / main_block.vertices.length;
    var currentKey = "case1"; // initialize with a case1

    document.addEventListener("DOMContentLoaded", function (event) {
        // Create a Map to store the data associated with each button
        let dataMap = new Map();
        // Get the keys from the dictionary
        const keys = Object.keys(adjustableCases);

        // Get the container where you want to add the buttons
        const buttonContainer = document.getElementById("button-container");

        // Iterate over the keys
        keys.forEach((key) => {
            // Create a new button element
            const btn = document.createElement("button");

            // Set the button's text to the case_name from the dictionary using the key
            btn.innerHTML = adjustableCases[key].case_name;
            btn.id = key;
            btn.classList.add("load-model-btn");

            // Add an event listener to the button
            btn.addEventListener("click", function () {
                // Store the data in the Map with the button's key as the map key
                dataMap.set(key, adjustableCases[key]);
                // Update the global variable
                currentKey = key;
                // Store the data in the Map with the button's key as the map key
                dataMap.set(key, adjustableCases[key]);
            });
            // Append the button to the container
            buttonContainer.appendChild(btn);
        });
    });
</script>

<script src="{% static 'djangojs/jquery.json.min.js' %}"></script>

<script>
    var accessKeyID = "{{ AWS_ACCESS_KEY_ID }}";
    var secretAccessKey = "{{ AWS_SECRET_ACCESS_KEY }}";
</script>

<script src="https://sdk.amazonaws.com/js/aws-sdk-2.103.0.min.js"></script>

<h5>
    <span id="house-address">{{ house_data.houseInfo.address_string }}</span>
</h5>

<div class="legend">
    <div class="legend-item">
        <div class="stick-line green-line"></div>
        <div>PD</div>
    </div>
    <div class="legend-item">
        <div class="stick-line orange-line"></div>
        <div>PP</div>
    </div>
    <div class="legend-item">
        <div class="stick-line red-line"></div>
        <div>Error</div>
    </div>
</div>

<div id="button-container"></div>
<!-- <div class="model-box col-md-12 padding_0" id="model-container">
    <canvas class="webgl"></canvas>
    <nav class="model">
        <ul class="model">
            <div id="my-gui-container"></div>
        </ul>
    </nav>
    <link rel="stylesheet" href="/static/css/model.css" />
</div> -->

<div class="container">
    <div class="model-box col-md-9 padding_0" id="model-container">
        <canvas class="webgl"></canvas>
    </div>

    <div class="side-box">
        <div class="top-content">
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque...
            <!-- A truncated version of Lorem Ipsum. You can expand it as needed. -->
        </div>
        <div class="bottom-content">
            Lorem ipsum...
            <!-- A shorter version of Lorem Ipsum for the bottom 20% section. -->
        </div>
    </div>
</div>

<div class="gui-containers">
    <div class="box">
        <nav class="model">
            <ul class="model">
                <div id="my-gui-container-1"></div>
            </ul>
        </nav>
    </div>
    <div class="box">
        <nav class="model">
            <ul class="model">
                <div id="my-gui-container-2"></div>
            </ul>
        </nav>
    </div>
    <div class="box">
        <nav class="model">
            <ul class="model">
                <div id="my-gui-container-3"></div>
            </ul>
        </nav>
    </div>
</div>

<div class="container">
    <!-- Main top section -->
    <div class="main-box"></div>
    <div class="side-box"></div>

    <!-- 3 boxes below main section -->
    <div class="small-box"></div>
    <div class="small-box"></div>
    <div class="small-box"></div>
</div>

{% endblock content %}
